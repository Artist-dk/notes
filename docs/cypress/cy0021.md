# **ğŸ”¥ Cypress Guide: Intercepting API Calls & Mocking API Responses ğŸš€**  

Cypress provides powerful **network request interception** using `cy.intercept()`, allowing us to **mock API responses**, **control network behavior**, and **test frontend interactions without a real backend**.

---

## **ğŸ“Œ 1ï¸âƒ£ What is `cy.intercept()`?**  
`cy.intercept()` **intercepts HTTP requests and responses** to control what the frontend receives from the backend. It replaces the older `cy.route()` (deprecated since Cypress v6).  

### **âœ¨ Why Use `cy.intercept()`?**  
âœ” **Simulate API responses** without needing a real backend.  
âœ” **Test different response scenarios** (success, failure, slow requests).  
âœ” **Ensure frontend handles API errors gracefully**.  
âœ” **Speed up tests by avoiding real API calls**.  

---

# **ğŸ“Œ 2ï¸âƒ£ Basic `cy.intercept()` Usage**  

### **âœ… Intercepting a `GET` Request (Mocking API Response)**
```javascript
cy.intercept('GET', '/api/users', {
  statusCode: 200,
  body: [{ id: 1, name: 'John Doe' }, { id: 2, name: 'Jane Doe' }],
}).as('getUsers');

cy.visit('/users'); 
cy.wait('@getUsers'); // Wait for the mocked API response
cy.get('.user-item').should('have.length', 2); // Verify UI update
```
âœ” **Prevents actual API call**, serving the mock response.  
âœ” **Ensures frontend displays correct user data**.  

---

# **ğŸ“Œ 3ï¸âƒ£ Mocking Different API Scenarios**  

### **âœ… Simulating API Failure (500 Internal Server Error)**
```javascript
cy.intercept('GET', '/api/users', {
  statusCode: 500,
  body: { error: 'Internal Server Error' },
}).as('getUsersError');

cy.visit('/users');
cy.wait('@getUsersError');
cy.get('.error-message').should('contain', 'Something went wrong');
```
âœ” **Tests how the frontend handles server failures**.  

---

### **âœ… Simulating Delayed Response (Network Latency)**
```javascript
cy.intercept('GET', '/api/users', (req) => {
  req.reply((res) => {
    res.delay(5000); // Simulates a 5-second delay
    res.send({ statusCode: 200, body: [{ id: 1, name: 'John Doe' }] });
  });
}).as('slowUsers');

cy.visit('/users');
cy.wait('@slowUsers');
cy.get('.loading-spinner').should('be.visible'); // Ensure UI shows a loading indicator
```
âœ” **Tests frontend responsiveness to slow APIs**.  

---

# **ğŸ“Œ 4ï¸âƒ£ Mocking API Calls with Dynamic Responses**  
We can **modify API responses dynamically** using a function inside `cy.intercept()`.

### **âœ… Example: Intercept Request & Modify Response**
```javascript
cy.intercept('GET', '/api/users', (req) => {
  req.reply((res) => {
    const modifiedResponse = res.body.map((user) => ({
      ...user,
      name: user.name.toUpperCase(), // Modify response data
    }));
    res.send({ statusCode: 200, body: modifiedResponse });
  });
}).as('modifyUsers');

cy.visit('/users');
cy.wait('@modifyUsers');
cy.get('.user-item').each(($el) => {
  cy.wrap($el).should('have.text', $el.text().toUpperCase());
});
```
âœ” **Dynamically modifies API response before sending it to the frontend**.  

---

# **ğŸ“Œ 5ï¸âƒ£ Validating Request Data (`req.body`, `req.headers`)**  

### **âœ… Intercepting a `POST` Request & Validating Payload**
```javascript
cy.intercept('POST', '/api/users', (req) => {
  expect(req.body).to.have.property('name', 'John Doe'); // Validate request payload
  req.reply({ statusCode: 201, body: { id: 1, name: 'John Doe' } });
}).as('createUser');

cy.visit('/users');
cy.get('#name').type('John Doe');
cy.get('#submit').click();
cy.wait('@createUser');
```
âœ” **Ensures correct request payload is sent from the frontend**.  

---

### **âœ… Validating Request Headers**
```javascript
cy.intercept('GET', '/api/users', (req) => {
  expect(req.headers).to.have.property('Authorization'); // Validate Auth Token
  req.reply({ statusCode: 200, body: [{ id: 1, name: 'John Doe' }] });
}).as('authUsers');

cy.visit('/users');
cy.wait('@authUsers');
```
âœ” **Verifies if API calls include required authentication headers**.  

---

# **ğŸ“Œ 6ï¸âƒ£ Using `cy.intercept()` for Testing Pagination, Search, Filters**  

### **âœ… Mocking Search Results Based on Query Parameter**
```javascript
cy.intercept('GET', '/api/users?search=John', {
  statusCode: 200,
  body: [{ id: 1, name: 'John Doe' }],
}).as('searchUsers');

cy.visit('/users');
cy.get('#search').type('John');
cy.wait('@searchUsers');
cy.get('.user-item').should('have.length', 1);
```
âœ” **Tests if search functionality filters results correctly**.  

---

### **âœ… Mocking Paginated API Responses**
```javascript
cy.intercept('GET', '/api/users?page=2', {
  statusCode: 200,
  body: [{ id: 3, name: 'Alice' }, { id: 4, name: 'Bob' }],
}).as('page2Users');

cy.visit('/users');
cy.get('#nextPage').click();
cy.wait('@page2Users');
cy.get('.user-item').should('have.length', 2);
```
âœ” **Simulates pagination and ensures UI updates correctly**.  

---

# **ğŸ“Œ 7ï¸âƒ£ Combining `cy.intercept()` with Assertions**  
### **âœ… Ensuring Correct API Request was Sent**
```javascript
cy.intercept('POST', '/api/login').as('loginRequest');

cy.get('#username').type('admin');
cy.get('#password').type('password123');
cy.get('#loginButton').click();

cy.wait('@loginRequest').then((interception) => {
  expect(interception.request.body).to.deep.equal({
    username: 'admin',
    password: 'password123',
  });
});
```
âœ” **Verifies correct credentials were sent to the API**.  

---

# **ğŸ“Œ 8ï¸âƒ£ Summary: `cy.intercept()` vs. `cy.request()`**
| Feature | `cy.intercept()` | `cy.request()` |
|---------|----------------|---------------|
| **Intercept API calls from the frontend?** | âœ… Yes | âŒ No |
| **Mock API responses?** | âœ… Yes | âŒ No |
| **Simulate slow or failed responses?** | âœ… Yes | âŒ No |
| **Directly make API calls (without UI interaction)?** | âŒ No | âœ… Yes |
| **Validate request body & headers?** | âœ… Yes | âœ… Yes |

---

# **ğŸš€ Key Takeaways**
âœ” **Use `cy.intercept()` to mock API calls** and test UI behavior.  
âœ” **Simulate different scenarios** like errors, slow responses, and pagination.  
âœ” **Verify request payloads & headers** to ensure correct data is sent.  
âœ” **Speed up tests** by bypassing unnecessary backend calls.  

Would you like **real-world API testing scenarios**, such as **JWT authentication, caching validation, or file uploads**? Let me know! ğŸ˜ŠğŸ”¥