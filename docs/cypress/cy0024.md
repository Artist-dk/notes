# **ğŸ”¥ Testing GraphQL APIs in Cypress ğŸš€**  

GraphQL APIs are different from REST because they allow **flexible queries** and **precise data fetching**. Cypress supports **GraphQL testing** by sending queries, validating responses, and mocking API calls using `cy.request()` and `cy.intercept()`.  

---

## **ğŸ“Œ 1ï¸âƒ£ Why Test GraphQL APIs?**  
âœ” **Ensure Correct Responses** â€“ Validate query results and data structure.  
âœ” **Test API Performance** â€“ Check response times and optimize queries.  
âœ” **Verify Query & Mutation Behavior** â€“ Ensure correct CRUD operations.  
âœ” **Mock GraphQL Responses** â€“ Simulate different scenarios like errors or slow responses.  

---

## **ğŸ“Œ 2ï¸âƒ£ Sending GraphQL Queries with `cy.request()`**  

Since GraphQL APIs use **POST requests** to a single endpoint (`/graphql`), Cypress can send requests using `cy.request()`.  

### **âœ… Example: Sending a Basic Query**
```javascript
cy.request({
  method: 'POST',
  url: '/graphql',  // Replace with your GraphQL endpoint
  body: {
    query: `
      query {
        users {
          id
          name
          email
        }
      }
    `,
  },
}).then((response) => {
  expect(response.status).to.eq(200);
  expect(response.body.data.users).to.be.an('array');
  expect(response.body.data.users[0]).to.have.property('name');
});
```
âœ” **Checks response status & verifies returned data structure.**  

---

## **ğŸ“Œ 3ï¸âƒ£ Validating GraphQL Responses**  

You can verify different parts of the response:  

### **âœ… Checking Status Code & Data Fields**
```javascript
cy.request({
  method: 'POST',
  url: '/graphql',
  body: {
    query: `
      query {
        user(id: "123") {
          name
          age
        }
      }
    `,
  },
}).then((response) => {
  expect(response.status).to.eq(200);
  expect(response.body).to.have.property('data');
  expect(response.body.data.user).to.have.property('name', 'John Doe');
});
```
âœ” **Ensures the correct user data is returned.**  

---

## **ğŸ“Œ 4ï¸âƒ£ Testing GraphQL Mutations (Create, Update, Delete Data)**  

GraphQL mutations allow modifying data. Cypress can send mutations and verify changes.  

### **âœ… Example: Creating a New User**
```javascript
cy.request({
  method: 'POST',
  url: '/graphql',
  body: {
    query: `
      mutation {
        createUser(input: { name: "Alice", email: "alice@example.com" }) {
          id
          name
          email
        }
      }
    `,
  },
}).then((response) => {
  expect(response.status).to.eq(200);
  expect(response.body.data.createUser).to.have.property('name', 'Alice');
});
```
âœ” **Confirms that user creation is successful.**  

---

## **ğŸ“Œ 5ï¸âƒ£ Mocking GraphQL API Responses with `cy.intercept()`**  

Sometimes, you need to **mock API responses** to test different scenarios. Cypress allows you to intercept GraphQL requests and return custom responses.  

### **âœ… Mocking a GraphQL Query Response**
```javascript
cy.intercept('POST', '/graphql', (req) => {
  if (req.body.query.includes('users')) {
    req.reply({
      data: {
        users: [{ id: 1, name: 'Mock User', email: 'mock@example.com' }],
      },
    });
  }
}).as('mockUsers');

cy.visit('/users');
cy.wait('@mockUsers');
cy.get('.user-name').should('contain', 'Mock User');
```
âœ” **Simulates an API response without hitting the real backend.**  

---

## **ğŸ“Œ 6ï¸âƒ£ Handling GraphQL Errors & Edge Cases**  

APIs sometimes return errors due to validation issues, authentication failures, or server errors. Cypress can test how an application handles these cases.  

### **âœ… Mocking an API Error Response**
```javascript
cy.intercept('POST', '/graphql', {
  statusCode: 400,
  body: {
    errors: [{ message: 'Invalid input data' }],
  },
}).as('graphqlError');

cy.visit('/profile');
cy.wait('@graphqlError');
cy.get('.error-message').should('contain', 'Invalid input data');
```
âœ” **Ensures UI displays error messages correctly.**  

---

## **ğŸ“Œ 7ï¸âƒ£ Testing GraphQL API Performance**  

GraphQL queries can sometimes **return large datasets**, which may slow down performance. Cypress can measure response times.  

### **âœ… Checking Response Time**
```javascript
cy.request({
  method: 'POST',
  url: '/graphql',
  body: {
    query: `
      query {
        products {
          id
          name
          price
        }
      }
    `,
  },
}).then((response) => {
  expect(response.duration).to.be.lessThan(500); // Ensures response time is under 500ms
});
```
âœ” **Validates API speed and helps optimize queries.**  

---

## **ğŸ“Œ 8ï¸âƒ£ Verifying UI After GraphQL Requests**  

Since Cypress supports **UI + API testing**, you can validate UI updates after GraphQL API calls.  

### **âœ… Testing UI After API Response**
```javascript
cy.intercept('POST', '/graphql', {
  data: { user: { name: 'Alice', age: 25 } },
}).as('userData');

cy.visit('/profile');
cy.wait('@userData');
cy.get('.user-name').should('contain', 'Alice');
```
âœ” **Ensures UI updates correctly after fetching user data.**  

---

## **ğŸ“Œ 9ï¸âƒ£ Summary: Cypress GraphQL API Testing âœ…**  
âœ… **Send GraphQL queries & mutations** using `cy.request()`.  
âœ… **Validate response status, structure, and data fields**.  
âœ… **Mock GraphQL API responses** with `cy.intercept()`.  
âœ… **Simulate API errors & slow responses**.  
âœ… **Measure API performance & response times**.  
âœ… **Ensure UI updates correctly after GraphQL calls**.  

---

## **ğŸš€ Whatâ€™s Next?**  
Would you like examples for:  
âœ” **GraphQL Pagination Testing?**  
âœ” **Handling Authentication (JWT, Tokens)?**  
âœ” **Testing GraphQL with React/Apollo?**  

Let me know! ğŸ˜ŠğŸ”¥