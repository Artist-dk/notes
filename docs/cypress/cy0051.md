# **ğŸ“Œ Mocking Dependencies in Cypress: Stubbing API Calls in UI Tests**  

Mocking dependencies in Cypress is crucial for **testing UI behavior independently** of backend services. This ensures that tests run **faster, more reliably, and consistently**, even when the backend is unavailable or changing.  

---

# **ğŸ”¹ 1ï¸âƒ£ Why Stub API Calls?**  
âœ… **Faster tests** â€“ No need to wait for real API responses.  
âœ… **Avoid flakiness** â€“ Eliminates network issues and unstable data.  
âœ… **Control test scenarios** â€“ Easily simulate **error responses, slow requests, or empty data**.  
âœ… **Improve test reliability** â€“ Ensure UI behavior remains consistent across different responses.  

---

# **ğŸ”¹ 2ï¸âƒ£ Cypress API Stubbing Methods**  
Cypress provides two primary ways to mock API responses:  

| Method           | Description |
|-----------------|------------|
| **`cy.intercept()`** | Modern approach to intercept and modify network requests. |
| **`cy.stub()`** | Used for replacing JavaScript functions, often combined with Cypress commands. |

**ğŸ’¡ `cy.intercept()` is preferred for API stubbing.**  

---

# **ğŸ”¹ 3ï¸âƒ£ Basic API Stubbing with `cy.intercept()`**  
## **âœ… Example: Stubbing a GET Request**  
Mocking a `/users` API call in a UI test:  
```javascript
describe('Mock API Calls', () => {
  it('displays mock user data', () => {
    cy.intercept('GET', '/api/users', {
      statusCode: 200,
      body: [{ id: 1, name: 'John Doe' }]
    }).as('getUsers');

    cy.visit('/users');
    cy.wait('@getUsers');

    cy.get('.user-item').should('contain', 'John Doe');
  });
});
```
âœ” Cypress intercepts the request and **returns mock data instead of calling the actual API**.  
âœ” `@getUsers` alias is used to **wait for and verify the request**.  

---

## **âœ… Example: Stubbing a POST Request**  
Mocking a `POST` request to `/api/login`:  
```javascript
cy.intercept('POST', '/api/login', {
  statusCode: 200,
  body: { token: 'mock-token-123' }
}).as('login');

cy.get('input[name="email"]').type('test@example.com');
cy.get('input[name="password"]').type('password123');
cy.get('button[type="submit"]').click();

cy.wait('@login');
cy.get('.welcome-message').should('contain', 'Welcome, test@example.com');
```
âœ” Cypress mocks a **successful login response**, returning a fake token.  

---

# **ğŸ”¹ 4ï¸âƒ£ Mocking API Errors & Edge Cases**  
## **âœ… Example: Simulating a 500 Server Error**  
```javascript
cy.intercept('GET', '/api/orders', {
  statusCode: 500,
  body: { error: 'Internal Server Error' }
}).as('getOrders');

cy.visit('/orders');
cy.wait('@getOrders');

cy.get('.error-message').should('contain', 'Something went wrong');
```
âœ” UI should display an **error message when the API fails**.  

---

## **âœ… Example: Simulating a Delayed API Response**  
```javascript
cy.intercept('GET', '/api/products', (req) => {
  req.reply((res) => {
    res.delay = 5000; // 5-second delay
    res.send({ body: [{ id: 1, name: 'Product A' }] });
  });
}).as('getProducts');

cy.visit('/products');
cy.get('.loading-spinner').should('be.visible');
cy.wait('@getProducts');
cy.get('.loading-spinner').should('not.exist');
```
âœ” UI should **show a loading spinner** while waiting for the response.  

---

# **ğŸ”¹ 5ï¸âƒ£ Mocking API Calls with Dynamic Responses**  
Sometimes, you need to **dynamically modify responses** based on request parameters.

## **âœ… Example: Mocking API Responses Based on Query Params**  
```javascript
cy.intercept('GET', '/api/search?query=shoes', {
  statusCode: 200,
  body: [{ id: 101, name: 'Running Shoes' }]
}).as('searchShoes');

cy.get('input[name="search"]').type('shoes{enter}');
cy.wait('@searchShoes');

cy.get('.product-list').should('contain', 'Running Shoes');
```
âœ” Cypress intercepts **specific queries**, allowing for **flexible API testing**.  

---

# **ğŸ”¹ 6ï¸âƒ£ Using `cy.stub()` for Mocking Functions**  
Sometimes, you need to **mock internal JavaScript functions**, like `localStorage` or utility functions.

## **âœ… Example: Stubbing Local Storage**  
```javascript
cy.stub(window.localStorage, 'getItem').returns('mock-token-123');

cy.visit('/dashboard');
cy.get('.welcome-message').should('contain', 'Welcome Back!');
```
âœ” Ensures UI behaves as if a valid session exists.  

---

## **âœ… Example: Stubbing an API Call Inside a Function**  
Imagine you have an API call inside a function:  
```javascript
const fetchUser = async () => {
  const response = await fetch('/api/user');
  return response.json();
};
```
You can **stub it in tests**:  
```javascript
cy.stub(window, 'fetch')
  .resolves(new Response(JSON.stringify({ name: 'John Doe' })));

fetchUser().then((data) => {
  expect(data.name).to.equal('John Doe');
});
```
âœ” Prevents real network requests **while testing the function**.  

---

# **ğŸ”¹ 7ï¸âƒ£ Mocking Third-Party APIs**  
If your app calls external APIs like **Stripe, Firebase, or Google Maps**, mock them to avoid real API calls.

## **âœ… Example: Stubbing a Stripe Payment API Call**  
```javascript
cy.intercept('POST', 'https://api.stripe.com/v1/payment_intents', {
  statusCode: 200,
  body: { id: 'pi_mock123', status: 'succeeded' }
}).as('stripePayment');

cy.get('button#pay').click();
cy.wait('@stripePayment');

cy.get('.confirmation-message').should('contain', 'Payment successful');
```
âœ” Ensures UI **handles payment confirmation properly**.  

---

# **ğŸ”¹ 8ï¸âƒ£ Using Fixtures for API Mocking**  
Instead of defining responses **inline**, you can use **fixtures** (JSON files).

## **âœ… Example: Loading Mock Data from a Fixture**  
ğŸ“Œ **Create `cypress/fixtures/users.json`**  
```json
[
  { "id": 1, "name": "Alice" },
  { "id": 2, "name": "Bob" }
]
```

ğŸ“Œ **Use It in the Test**  
```javascript
cy.intercept('GET', '/api/users', { fixture: 'users.json' }).as('getUsers');

cy.visit('/users');
cy.wait('@getUsers');

cy.get('.user-item').should('contain', 'Alice').and('contain', 'Bob');
```
âœ” **Keeps test data separate and reusable**.  

---

# **ğŸš€ Key Takeaways**  
âœ… **Use `cy.intercept()` to stub API calls in UI tests.**  
âœ… **Mock different scenarios** (success, failure, delays) to **test UI resilience**.  
âœ… **Use `cy.stub()` for mocking internal functions like `localStorage`.**  
âœ… **Use fixtures** (`cypress/fixtures/*.json`) for **reusable test data**.  
âœ… **Mock third-party APIs** like Stripe, Firebase, etc.  

---

### **ğŸ“¢ Need More?**  
âœ” Want **advanced API testing with Cypress**?  
âœ” Need **help with GraphQL or WebSockets testing**?  
âœ” Looking for **Cypress CI/CD integration**?  

Let me know! ğŸ˜ŠğŸš€