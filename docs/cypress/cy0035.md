# **ğŸ”„ Test Retry Mechanism in Cypress**  
### **Configuring Retries in `cypress.config.js`**  

When running end-to-end tests, **flaky tests** (intermittently failing tests) can slow down development and CI/CD pipelines. Cypress offers a **test retry mechanism** to automatically retry failing tests before marking them as failed. This is especially useful for handling **network delays, dynamic UI elements, and third-party API calls**.

---

## **âœ… Why Use Test Retries?**  
- **Handles Flaky Tests**: Retries tests that fail due to network issues, dynamic UI behavior, or inconsistent loading times.  
- **Reduces Manual Reruns**: Instead of rerunning the entire test suite, Cypress automatically retries individual failing tests.  
- **Improves CI/CD Stability**: Tests pass more consistently without manual intervention.  

---

## **ğŸ”§ 1ï¸âƒ£ Enabling Test Retries in Cypress**  

Cypress allows you to **configure retries globally or per test**.

### **ğŸŒ Global Retry Configuration**  
You can enable retries for **all tests** in the `cypress.config.js` file.  

```javascript
const { defineConfig } = require('cypress');

module.exports = defineConfig({
  e2e: {
    retries: {
      runMode: 2,  // Retries when running `cypress run` (headless mode)
      openMode: 1   // Retries when running `cypress open` (GUI mode)
    }
  }
});
```

ğŸ”¹ **runMode:** Applies to `cypress run` (CI/CD or command-line execution).  
ğŸ”¹ **openMode:** Applies to `cypress open` (interactive test execution).  

ğŸ“Œ **Example:** If a test fails in headless mode (`cypress run`), Cypress **automatically retries it 2 times**.

---

## **ğŸ› ï¸ 2ï¸âƒ£ Setting Retries Per Test or Suite**  
Instead of configuring retries globally, you can apply them **to specific tests or suites** using `.retries(n)`.

### **âœ… Applying Retries to a Specific Test**
```javascript
it('Retries this test up to 3 times', { retries: 3 }, () => {
  cy.visit('/dashboard');
  cy.get('.loading').should('not.exist');  // May fail if the page loads slowly
});
```
ğŸ“Œ **This test will retry up to 3 times before failing.**

---

### **âœ… Applying Retries to a Test Suite**
```javascript
describe('User Authentication', { retries: 2 }, () => {
  it('should log in successfully', () => {
    cy.visit('/login');
    cy.get('#username').type('testuser');
    cy.get('#password').type('password123');
    cy.get('#login-btn').click();
    cy.url().should('include', '/dashboard');  // Will retry if login fails
  });
});
```
ğŸ“Œ **All tests inside `describe()` will retry up to 2 times before failing.**

---

## **ğŸ”„ 3ï¸âƒ£ Retrying API Calls Using `cy.intercept()`**  
If a test depends on an **API call**, use `cy.intercept()` and `should()` to automatically retry assertions.

```javascript
cy.intercept('GET', '/api/user').as('getUser');
cy.wait('@getUser').its('response.statusCode').should('eq', 200);
```

ğŸ“Œ **Why?** Cypress **retries assertions automatically** until they pass within the timeout.

---

## **â³ 4ï¸âƒ£ Controlling Retry Timeouts**  
Retries should **not extend test execution time unnecessarily**. Cypress allows setting **timeouts** to control this.

Modify **default command timeouts** in `cypress.config.js`:

```javascript
module.exports = defineConfig({
  defaultCommandTimeout: 10000, // Increases timeout to 10 seconds
  retries: {
    runMode: 2,
    openMode: 1
  }
});
```

---

## **ğŸ›‘ 5ï¸âƒ£ Disabling Retries for Specific Tests**  
You can **disable retries** for tests where they are unnecessary.

```javascript
it('This test should not retry', { retries: 0 }, () => {
  cy.visit('/profile');
  cy.get('#user-info').should('be.visible');
});
```
ğŸ“Œ **Why?** Prevents unnecessary retries when failures are not expected to be intermittent.

---

## **ğŸ“Š 6ï¸âƒ£ Viewing Retries in Cypress Dashboard**  
If you use **Cypress Cloud (Dashboard)**, retries are logged under "Test Runs" with indicators showing how many retries were attempted.

- âœ… **Green:** Passed test  
- âŒ **Red:** Failed test  
- ğŸ”„ **Yellow:** Retried test  

Run tests with dashboard recording:

```sh
npx cypress run --record
```

ğŸ“Œ **Why?** Helps track flaky tests and retry patterns in **CI/CD pipelines**.

---

## **ğŸ“Œ Summary: Best Practices for Test Retries**  
âœ… Enable retries **globally** in `cypress.config.js`.  
âœ… Use `.retries(n)` for **individual tests** and **suites** when needed.  
âœ… Avoid using retries **for truly broken tests**â€”fix the root cause instead.  
âœ… Combine **retries with `cy.intercept()`** for API tests.  
âœ… Monitor **retry patterns in Cypress Cloud** to detect flaky tests.  

---

## **ğŸš€ Whatâ€™s Next?**  
Would you like:  
âœ” **CI/CD Retry Strategy Examples?**  
âœ” **Debugging Flaky Tests in Cypress?**  
âœ” **Optimizing Test Timeouts with Retries?**  

Let me know! ğŸ˜ŠğŸ”¥